#!/bin/bash
# Claude Code cache cleanup script
# Run periodically to free disk space

CLAUDE_DIR="$HOME/.claude"

echo "Cleaning Claude Code caches..."

COUNT=0

# Delete files older than 3 days (keeps recent for debugging)
for dir in debug todos shell-snapshots plans file-history session-env; do
    DELETED=$(find "${CLAUDE_DIR}/${dir}" -type f -mtime +3 -print -delete 2>/dev/null | wc -l)
    COUNT=$((COUNT + DELETED))
done

# Truncate logs
: > "$CLAUDE_DIR/hooks.log" 2>/dev/null

# Remove Python cache
DELETED=$(find "$CLAUDE_DIR" -type d -name "__pycache__" -print -exec rm -rf {} + 2>/dev/null | wc -l)
COUNT=$((COUNT + DELETED))

# Remove .DS_Store files
DELETED=$(find "$CLAUDE_DIR" -name ".DS_Store" -print -delete 2>/dev/null | wc -l)
COUNT=$((COUNT + DELETED))

echo "Done. Cleaned up $COUNT files."

# Show macOS notification
osascript -e "display notification \"Cleaned up $COUNT files\" with title \"Claude Code\""
