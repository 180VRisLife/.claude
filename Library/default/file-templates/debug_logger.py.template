"""
debug_logger.py
{{PROJECT_NAME}}

Centralized debug logging service
- In DEBUG mode: Logs to file and console
- In RELEASE mode: Minimal logging (warnings/errors only)
- Auto-generated by /init-workspace
"""

import logging
import os
from pathlib import Path
from typing import Literal

# Log categories
LogCategory = Literal['app', 'data', 'network', 'api', 'general']

# Determine if we're in debug mode
IS_DEBUG = os.getenv('DEBUG', '0') == '1' or os.getenv('ENVIRONMENT', '').lower() == 'development'


class DebugLogger:
    """
    Centralized logging with DEBUG/RELEASE mode handling.

    DEBUG mode: Logs to file and console with verbose output
    RELEASE mode: Minimal logging (info and above only)
    """

    def __init__(self, project_name: str = '{{PROJECT_NAME}}'):
        self.project_name = project_name
        self.is_debug = IS_DEBUG

        # Configure logger
        self.logger = logging.getLogger(project_name)
        self.logger.setLevel(logging.DEBUG if self.is_debug else logging.INFO)

        # Prevent duplicate handlers
        if not self.logger.handlers:
            # Console handler
            console = logging.StreamHandler()
            console_format = logging.Formatter(
                '[%(levelname)s] [%(category)s] %(message)s'
            )
            console.setFormatter(console_format)
            self.logger.addHandler(console)

            # File handler (DEBUG only)
            if self.is_debug:
                log_file = Path(f"/tmp/{project_name}-Debug.log")
                file_handler = logging.FileHandler(log_file, mode='w')
                file_format = logging.Formatter(
                    '%(asctime)s [%(levelname)s] [%(category)s] %(message)s',
                    datefmt='%Y-%m-%d %H:%M:%S'
                )
                file_handler.setFormatter(file_format)
                self.logger.addHandler(file_handler)

                # Write header
                self.logger.info(
                    f"=== {project_name} Debug Log ===",
                    extra={'category': 'app'}
                )
                self.logger.info(
                    f"Log file: {log_file}",
                    extra={'category': 'app'}
                )

    def log(self, message: str, category: LogCategory = 'general') -> None:
        """Log a debug message (DEBUG mode only)"""
        if not self.is_debug:
            return
        self.logger.debug(message, extra={'category': category})

    def info(self, message: str, category: LogCategory = 'general') -> None:
        """Log an info message"""
        self.logger.info(message, extra={'category': category})

    def warning(self, message: str, category: LogCategory = 'general') -> None:
        """Log a warning message"""
        self.logger.warning(message, extra={'category': category})

    def error(self, message: str, category: LogCategory = 'general') -> None:
        """Log an error message"""
        self.logger.error(message, extra={'category': category})

    def separator(self) -> None:
        """Log a separator for visual organization (DEBUG mode only)"""
        if not self.is_debug:
            return
        separator = '-' * 80
        for handler in self.logger.handlers:
            if isinstance(handler, logging.FileHandler):
                handler.stream.write(separator + '\n')
                handler.flush()


# Global instance
logger = DebugLogger()


# Usage examples
if __name__ == '__main__':
    # Set debug mode
    os.environ['DEBUG'] = '1'

    # Create new logger instance
    test_logger = DebugLogger('TestApp')

    test_logger.log("Application started", 'app')
    test_logger.info("Loading configuration", 'app')
    test_logger.warning("API rate limit approaching", 'network')
    test_logger.error("Failed to connect to database", 'data')
    test_logger.separator()
    test_logger.log("Debug section", 'general')
