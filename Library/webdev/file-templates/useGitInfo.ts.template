/**
 * useGitInfo.ts
 * {{PROJECT_NAME}}
 *
 * React hook for accessing git information in development builds
 * Auto-generated by /init-workspace
 */

'use client';

import { useMemo } from 'react';

interface GitInfo {
	branch: string | null;
	hash: string | null;
	displayString: string;
}

/**
 * Hook to access git information (development only)
 *
 * @returns Git info object or null in production
 *
 * @example
 * ```tsx
 * function MyComponent() {
 *   const gitInfo = useGitInfo();
 *
 *   if (!gitInfo) return null; // Production
 *
 *   return <div>Git: {gitInfo.displayString}</div>;
 * }
 * ```
 */
export function useGitInfo(): GitInfo | null {
	return useMemo(() => {
		// Only available in development
		if (process.env.NODE_ENV !== 'development') {
			return null;
		}

		const branch = process.env.NEXT_PUBLIC_GIT_BRANCH || null;
		const hash = process.env.NEXT_PUBLIC_GIT_HASH || null;

		if (!branch || !hash) {
			return {
				branch: null,
				hash: null,
				displayString: '[unknown]'
			};
		}

		// Check for detached HEAD (branch would be "HEAD")
		const isDetached = branch === 'HEAD';

		const displayString = isDetached
			? `[@${hash}]`
			: `[${branch}@${hash}]`;

		return {
			branch: isDetached ? null : branch,
			hash,
			displayString
		};
	}, []);
}

/**
 * Get git info as plain values (non-hook version)
 * Useful in server components or non-React contexts
 */
export function getGitInfo(): GitInfo | null {
	if (process.env.NODE_ENV !== 'development') {
		return null;
	}

	const branch = process.env.NEXT_PUBLIC_GIT_BRANCH || null;
	const hash = process.env.NEXT_PUBLIC_GIT_HASH || null;

	if (!branch || !hash) {
		return {
			branch: null,
			hash: null,
			displayString: '[unknown]'
		};
	}

	const isDetached = branch === 'HEAD';

	return {
		branch: isDetached ? null : branch,
		hash,
		displayString: isDetached ? `[@${hash}]` : `[${branch}@${hash}]`
	};
}
